<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso de Análisis de Datos con JavaScript</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #0d47a1;
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            margin: 0;
            font-size: 32px;
        }
        
        .subtitle {
            font-style: italic;
            opacity: 0.8;
            margin-top: 10px;
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #0d47a1;
            border-bottom: 2px solid #e1e4e8;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .grafico-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        
        .code-example {
            background-color: #f8f9fa;
            border-left: 4px solid #0d47a1;
            padding: 15px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #0d47a1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #1565c0;
        }
        
        .info-box {
            background-color: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
        }
        
        .warning-box {
            background-color: #fff8e1;
            border-left: 4px solid #ffb300;
            padding: 15px;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        table, th, td {
            border: 1px solid #ddd;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
            color: #333;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            background-color: #333;
            color: white;
        }
        
        /* Estilos para dispositivos móviles */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .grafico-container {
                height: 300px;
            }
            
            .code-example {
                font-size: 12px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Análisis de Datos Financieros con JavaScript</h1>
            <p class="subtitle">Guía práctica para importación de bibliotecas, manejo de datos, modelado y visualización</p>
        </div>
    </header>
    
    <div class="container">
        <div class="section">
            <h2>1. Introducción</h2>
            <p>Este tutorial te guiará a través del proceso completo de análisis de datos financieros utilizando JavaScript puro en el navegador. Aprenderás a:</p>
            <ul>
                <li>Importar bibliotecas externas de forma dinámica</li>
                <li>Obtener datos financieros de Yahoo Finance</li>
                <li>Procesar y manipular conjuntos de datos</li>
                <li>Aplicar modelos estadísticos como ARIMA</li>
                <li>Crear visualizaciones interactivas con Plotly.js</li>
            </ul>
            
            <div class="info-box">
                <p><strong>Nota:</strong> Este tutorial está enfocado en propósitos educativos y de demostración. Para aplicaciones en producción, considera el uso de herramientas más robustas como Python con pandas, statsmodels y scikit-learn.</p>
            </div>
        </div>
        
        <div class="section">
            <h2>2. Importación de Bibliotecas</h2>
            <p>En JavaScript para navegadores, existen diferentes formas de cargar bibliotecas externas. La más flexible es la carga dinámica mediante JavaScript:</p>
            
            <div class="code-example">
                <pre>// Función para cargar scripts dinámicamente
function cargarScript(url) {
    return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = url;
        script.onload = resolve;
        script.onerror = () => reject(new Error(`Error al cargar: ${url}`));
        document.head.appendChild(script);
    });
}

// Ejemplo de uso
async function cargarBibliotecas() {
    try {
        await cargarScript('https://cdn.plot.ly/plotly-latest.min.js');
        await cargarScript('https://cdn.jsdelivr.net/npm/arima@0.2.5/load.js');
        console.log('Bibliotecas cargadas correctamente');
    } catch (error) {
        console.error('Error:', error);
    }
}</pre>
            </div>
            
            <button id="btn-cargar" class="btn">Cargar Bibliotecas</button>
            <div id="status-bibliotecas"></div>
        </div>
        
        <div class="section">
            <h2>3. Obtención de Datos Financieros</h2>
            <p>Podemos obtener datos de Yahoo Finance utilizando su API no oficial:</p>
            
            <div class="code-example">
                <pre>async function obtenerDatosYahooFinance(symbol, interval = '1d', range = '1y') {
    // Construir URL para Yahoo Finance
    const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=${interval}&range=${range}`;
    
    // Usar un proxy para evitar problemas CORS
    const proxyUrl = `https://cors-anywhere.herokuapp.com/${url}`;
    
    const respuesta = await fetch(proxyUrl);
    const datos = await respuesta.json();
    
    // Procesar datos
    const resultado = datos.chart.result[0];
    const timestamps = resultado.timestamp;
    const cotizaciones = resultado.indicators.quote[0];
    
    // Formatear datos
    return timestamps.map((timestamp, i) => ({
        fecha: new Date(timestamp * 1000).toISOString().split('T')[0],
        apertura: cotizaciones.open[i],
        maximo: cotizaciones.high[i],
        minimo: cotizaciones.low[i],
        cierre: cotizaciones.close[i],
        volumen: cotizaciones.volume[i]
    }));
}</pre>
            </div>
            
            <div style="margin: 20px 0; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                <h3 style="margin-top: 0; color: #0d47a1;">Configuración de Datos</h3>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: inline-block; width: 150px; font-weight: bold;">Ticker:</label>
                    <input id="input-ticker" type="text" value="AAPL" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; width: 100px;" placeholder="Ej: AAPL" />
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: inline-block; width: 150px; font-weight: bold;">Periodo:</label>
                    <select id="select-periodo" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; width: 200px;">
                        <option value="1d" selected>Diario (1d)</option>
                        <option value="1wk">Semanal (1wk)</option>
                        <option value="1mo">Mensual (1mo)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: inline-block; width: 150px; font-weight: bold;">Rango histórico:</label>
                    <select id="select-rango" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; width: 200px;">
                        <option value="3mo" selected>3 meses</option>
                        <option value="6mo">6 meses</option>
                        <option value="1y">1 año</option>
                        <option value="5y">5 años</option>
                    </select>
                </div>
            </div>
            
            <button id="btn-obtener-datos" class="btn">Obtener Datos</button>
            <div id="datos-resumen"></div>
        </div>
        
        <div class="section">
            <h2>4. Visualización de Datos</h2>
            <p>Utilizando Plotly.js, podemos crear gráficos interactivos para analizar datos financieros:</p>
            
            <div id="grafico" class="grafico-container"></div>
            
            <div class="code-example">
                <pre>function crearGraficoVelas(datos, contenedorId) {
    const trace = {
        x: datos.map(d => d.fecha),
        open: datos.map(d => d.apertura),
        high: datos.map(d => d.maximo),
        low: datos.map(d => d.minimo),
        close: datos.map(d => d.cierre),
        type: 'candlestick',
        increasing: {line: {color: '#00A651'}, fillcolor: 'rgba(0, 166, 81, 0.5)'},
        decreasing: {line: {color: '#E63946'}, fillcolor: 'rgba(230, 57, 70, 0.5)'}
    };
    
    const layout = {
        title: 'Gráfico de Velas',
        xaxis: {title: 'Fecha'},
        yaxis: {title: 'Precio'}
    };
    
    Plotly.newPlot(contenedorId, [trace], layout);
}</pre>
            </div>
            
            <button id="btn-crear-grafico" class="btn">Crear Gráfico de Velas</button>
        </div>
        
        <div class="section">
            <h2>5. Modelos Estadísticos</h2>
            <p>La implementación de modelos como ARIMA permite realizar predicciones sobre series temporales:</p>
            
            <div class="code-example">
                <pre>function modeloARIMA(datos, params = {p: 1, d: 1, q: 1}, horizonte = 30) {
    // Extraer valores de cierre
    const valores = datos.map(d => d.cierre);
    
    // Configurar modelo ARIMA
    const arimaConfig = {
        p: params.p,
        d: params.d,
        q: params.q,
        verbose: false
    };
    
    // Entrenar modelo y hacer predicción
    const arimaModel = new ARIMA(arimaConfig).train(valores);
    const prediccion = arimaModel.predict(horizonte);
    
    return prediccion;
}</pre>
            </div>
            
            <div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;">
                <label for="input-p">p:</label>
                <input id="input-p" type="number" min="0" value="5" style="width:70px;padding:6px;border:1px solid #ccc;border-radius:4px;" />
                <label for="input-d">d:</label>
                <input id="input-d" type="number" min="0" value="1" style="width:70px;padding:6px;border:1px solid #ccc;border-radius:4px;" />
                <label for="input-q">q:</label>
                <input id="input-q" type="number" min="0" value="1" style="width:70px;padding:6px;border:1px solid #ccc;border-radius:4px;" />
                <button id="btn-prediccion" class="btn">Realizar Predicción</button>
            </div>
            <div id="grafico-prediccion" class="grafico-container"></div>
        </div>
        
        <div class="section">
            <h2>6. Intervalos de Confianza en Predicciones</h2>
            <p>Los intervalos de confianza nos permiten cuantificar la incertidumbre en nuestras predicciones. Cuanto más lejos proyectamos en el futuro, mayor es la incertidumbre.</p>
            
            <div class="info-box">
                <p><strong>¿Qué son los intervalos de confianza?</strong></p>
                <p>Un intervalo de confianza del 95% significa que esperamos que el valor real caiga dentro de ese rango el 95% de las veces. Es una forma de expresar la incertidumbre de nuestras predicciones.</p>
            </div>
            
            <div class="code-example">
                <pre>// Calcular intervalos de confianza
const calculador = new IntervalosConfianza(datosHistoricos, predicciones);

// Método 1: Basado en desviación estándar
const intervalos95 = calculador.calcularIntervaloDesviacionEstandar(0.95);

// Método 2: Basado en volatilidad del activo
const intervalosVol = calculador.calcularIntervaloVolatilidad(20, 0.95);

// Método 3: Bootstrap (simulaciones)
const intervalosBootstrap = calculador.calcularIntervaloBootstrap(0.95, 1000);

// Método 4: Combinado (más robusto)
const intervalosRobustos = calculador.calcularIntervalosRobustos({
    nivelConfianza: 0.95,
    ventanaVolatilidad: 20
});</pre>
            </div>
            
            <div style="margin: 20px 0;">
                <label style="display: inline-block; margin-right: 10px;"><strong>Método de cálculo:</strong></label>
                <select id="select-metodo-ic" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                    <option value="desviacionEstandar">Desviación Estándar</option>
                    <option value="volatilidad" selected>Volatilidad</option>
                    <option value="bootstrap">Bootstrap</option>
                    <option value="robusto">Robusto (Combinado)</option>
                </select>
                
                <label style="display: inline-block; margin-left: 20px; margin-right: 10px;"><strong>Nivel de confianza:</strong></label>
                <select id="select-nivel-confianza" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                    <option value="0.80">80%</option>
                    <option value="0.90">90%</option>
                    <option value="0.95" selected>95%</option>
                    <option value="0.99">99%</option>
                </select>
            </div>
            
            <button id="btn-ic-simple" class="btn">Predicción con Intervalo de Confianza</button>
            <button id="btn-ic-multiple" class="btn" style="background-color: #43A047;">Múltiples Niveles de Confianza</button>
            
            <div id="grafico-intervalos" class="grafico-container"></div>
            
            <div class="warning-box">
                <p><strong>Interpretación:</strong></p>
                <ul>
                    <li><strong>Banda sombreada:</strong> Representa el intervalo de confianza. Los valores reales futuros deberían caer dentro de esta banda con la probabilidad especificada.</li>
                    <li><strong>Expansión del intervalo:</strong> Nota cómo el intervalo se expande a medida que nos alejamos en el tiempo, reflejando mayor incertidumbre.</li>
                    <li><strong>Métodos diferentes:</strong> Cada método tiene sus ventajas. La volatilidad es útil para activos financieros, mientras que el bootstrap es más general.</li>
                </ul>
            </div>
        </div>
        
        <div class="section">
            <h2>7. Análisis Comparativo</h2>
            <p>Podemos comparar el rendimiento de diferentes acciones normalizando a base 100:</p>
            
            <div id="grafico-comparativo" class="grafico-container"></div>
            
            <div class="code-example">
                <pre>function normalizarBase100(datos) {
    const valorBase = datos[0].cierre;
    
    return datos.map(item => ({
        fecha: item.fecha,
        cierre: (item.cierre / valorBase) * 100
    }));
}

function crearGraficoComparativo(datosPorTicker, contenedorId) {
    const trazas = Object.entries(datosPorTicker).map(([ticker, datos], i) => {
        const datosNormalizados = normalizarBase100(datos);
        
        return {
            x: datosNormalizados.map(d => d.fecha),
            y: datosNormalizados.map(d => d.cierre),
            type: 'scatter',
            mode: 'lines',
            name: ticker
        };
    });
    
    const layout = {
        title: 'Comparación de Rendimiento (Base 100)',
        xaxis: {title: 'Fecha'},
        yaxis: {title: 'Valor (Base 100)'}
    };
    
    Plotly.newPlot(contenedorId, trazas, layout);
}</pre>
            </div>
            
            <button id="btn-comparar" class="btn">Comparar Tickers</button>
        </div>
        
        <div class="section">
            <h2>8. Implementación Completa</h2>
            <p>Hemos creado un archivo completo con todas estas funcionalidades que puedes revisar:</p>
            <p><strong>Archivo:</strong> <code>CursoJavaScriptAnalisisDatos.js</code></p>
            
            <div class="info-box">
                <p>El archivo incluye implementaciones detalladas de:</p>
                <ul>
                    <li>Carga dinámica de bibliotecas con manejo de errores y fallbacks</li>
                    <li>API para interactuar con Yahoo Finance</li>
                    <li>Procesamiento de datos financieros</li>
                    <li>Modelos estadísticos (MA, AR, ARIMA)</li>
                    <li>Cálculo de intervalos de confianza (múltiples métodos)</li>
                    <li>Visualización interactiva con múltiples tipos de gráficos</li>
                </ul>
                <p>¡Explora el código para aprender más sobre análisis de datos en JavaScript!</p>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>© 2025 - Curso JavaScript para Análisis de Datos</p>
            <p>Creado para fines educativos</p>
        </div>
    </footer>
    
    <!-- Cargar nuestro archivo principal de curso -->
    <script src="CursoJavaScriptAnalisisDatos.js"></script>
    
    <!-- Script para la demostración interactiva -->
    <script>
        // Variables para almacenar datos de demostración
        let datosDemostracion = {};
        let bibliotecasCargadas = false;
        
        // Elementos del DOM
        const btnCargar = document.getElementById('btn-cargar');
        const btnObtenerDatos = document.getElementById('btn-obtener-datos');
        const btnCrearGrafico = document.getElementById('btn-crear-grafico');
        const btnPrediccion = document.getElementById('btn-prediccion');
        const btnICSimple = document.getElementById('btn-ic-simple');
        const btnICMultiple = document.getElementById('btn-ic-multiple');
        const btnComparar = document.getElementById('btn-comparar');
        
        const statusBibliotecas = document.getElementById('status-bibliotecas');
        const datosResumen = document.getElementById('datos-resumen');
        
        // Event listeners
        btnCargar.addEventListener('click', async () => {
            statusBibliotecas.innerHTML = '<p>Cargando bibliotecas...</p>';
            statusBibliotecas.style.color = '#2196F3';
            
            try {
                await cargarBibliotecas();
                bibliotecasCargadas = true;
                statusBibliotecas.innerHTML = '<p>✅ Bibliotecas cargadas correctamente</p>';
                statusBibliotecas.style.color = '#4CAF50';
            } catch (error) {
                statusBibliotecas.innerHTML = `<p>❌ Error al cargar bibliotecas: ${error.message}</p>`;
                statusBibliotecas.style.color = '#F44336';
            }
        });
        
        btnObtenerDatos.addEventListener('click', async () => {
            if (!bibliotecasCargadas) {
                datosResumen.innerHTML = '<p>⚠️ Primero debes cargar las bibliotecas</p>';
                datosResumen.style.color = '#FF9800';
                return;
            }
            
            // Obtener los valores seleccionados
            const ticker = document.getElementById('input-ticker').value.toUpperCase() || 'AAPL';
            const periodo = document.getElementById('select-periodo').value;
            const rango = document.getElementById('select-rango').value;
            
            // Obtener el nombre descriptivo del periodo y rango
            const yahooAPI = new YahooFinanceAPI();
            const periodoTexto = yahooAPI.traducirPeriodo(periodo);
            const rangoTexto = yahooAPI.traducirRango(rango);
            
            datosResumen.innerHTML = `<p>Obteniendo datos de ${ticker} (${periodoTexto}, ${rangoTexto})...</p>`;
            datosResumen.style.color = '#2196F3';
            
            try {
                // Obtener datos para el ticker principal
                datosDemostracion[ticker] = await yahooAPI.obtenerDatosHistoricos(ticker, periodo, rango);
                
                // También obtener datos de MSFT y GOOG para comparaciones (si no es el ticker principal)
                if (ticker !== 'AAPL') {
                    datosDemostracion.AAPL = await yahooAPI.obtenerDatosHistoricos('AAPL', periodo, rango);
                }
                if (ticker !== 'MSFT') {
                    datosDemostracion.MSFT = await yahooAPI.obtenerDatosHistoricos('MSFT', periodo, rango);
                }
                if (ticker !== 'GOOG') {
                    datosDemostracion.GOOG = await yahooAPI.obtenerDatosHistoricos('GOOG', periodo, rango);
                }
                
                // Mostrar resumen
                const tickersObtenidos = Object.keys(datosDemostracion);
                let resumenHTML = '<p>✅ Datos obtenidos correctamente:</p><ul>';
                tickersObtenidos.forEach(t => {
                    resumenHTML += `<li><strong>${t}:</strong> ${datosDemostracion[t].length} registros</li>`;
                });
                resumenHTML += '</ul>';
                
                if (datosDemostracion[ticker] && datosDemostracion[ticker].length > 0) {
                    resumenHTML += `<p><strong>Periodo:</strong> ${periodoTexto} | <strong>Rango:</strong> ${rangoTexto}</p>`;
                    resumenHTML += `<p><strong>Fechas:</strong> ${datosDemostracion[ticker][0].fecha} a ${datosDemostracion[ticker][datosDemostracion[ticker].length-1].fecha}</p>`;
                }
                
                datosResumen.innerHTML = resumenHTML;
                datosResumen.style.color = '#4CAF50';
            } catch (error) {
                datosResumen.innerHTML = `<p>❌ Error al obtener datos: ${error.message}</p>`;
                datosResumen.style.color = '#F44336';
            }
        });
        
        btnCrearGrafico.addEventListener('click', () => {
            if (!bibliotecasCargadas) {
                alert('Primero debes cargar las bibliotecas');
                return;
            }
            
            // Obtener el ticker actual
            const ticker = document.getElementById('input-ticker').value.toUpperCase() || 'AAPL';
            
            if (!datosDemostracion[ticker]) {
                alert(`No hay datos para ${ticker}. Primero obtén los datos.`);
                return;
            }
            
            const periodo = document.getElementById('select-periodo').value;
            const rango = document.getElementById('select-rango').value;
            
            const yahooAPI = new YahooFinanceAPI();
            const periodoTexto = yahooAPI.traducirPeriodo(periodo);
            const rangoTexto = yahooAPI.traducirRango(rango);
            
            const visualizador = new VisualizadorFinanciero('grafico');
            visualizador.crearGraficoVelas(
                datosDemostracion[ticker], 
                `${ticker} - ${periodoTexto}, ${rangoTexto}`
            );
        });
        
        btnPrediccion.addEventListener('click', () => {
            if (!bibliotecasCargadas) {
                alert('Primero debes cargar las bibliotecas');
                return;
            }
            
            // Obtener el ticker actual
            const ticker = document.getElementById('input-ticker').value.toUpperCase() || 'AAPL';
            
            if (!datosDemostracion[ticker]) {
                alert(`No hay datos para ${ticker}. Primero obtén los datos.`);
                return;
            }
            
            // Crear el gráfico de velas
            const visualizador = new VisualizadorFinanciero('grafico-prediccion');
            visualizador.crearGraficoVelas(datosDemostracion[ticker], `${ticker} con Predicción ARIMA`);
            
            // Crear y aplicar modelo predictivo leyendo p,d,q desde los inputs
            try {
                // Leer valores de los inputs
                const p = parseInt(document.getElementById('input-p').value, 10);
                const d = parseInt(document.getElementById('input-d').value, 10);
                const q = parseInt(document.getElementById('input-q').value, 10);

                // Validar
                if (Number.isNaN(p) || Number.isNaN(d) || Number.isNaN(q) || p < 0 || d < 0 || q < 0) {
                    alert('Por favor ingresa valores válidos (enteros >= 0) para p, d y q');
                    return;
                }

                // Mostrar en el status los parámetros seleccionados
                statusBibliotecas.innerHTML = `<p>Parámetros ARIMA seleccionados para ${ticker}: p=${p}, d=${d}, q=${q}</p>`;

                const modelador = new ModelosSeriesTemporales(datosDemostracion[ticker]);
                const prediccion = modelador.modeloARIMA(datosDemostracion[ticker], {p: p, d: d, q: q}, 30);

                visualizador.agregarPrediccion(prediccion, `Predicción ARIMA (p=${p},d=${d},q=${q})`, {
                    color: '#FF9800',
                    tipoLinea: 'dashdot',
                    grosor: 3
                });
            } catch (error) {
                alert('Error al realizar predicción: ' + error.message);
            }
        });
        
        btnComparar.addEventListener('click', () => {
            if (!bibliotecasCargadas || !datosDemostracion.AAPL) {
                alert('Primero debes cargar las bibliotecas y obtener los datos');
                return;
            }
            
            const visualizador = new VisualizadorFinanciero('grafico-comparativo');
            visualizador.crearGraficoComparativo(datosDemostracion, true, 'Comparación de Big Tech');
        });
        
        btnICSimple.addEventListener('click', () => {
            if (!bibliotecasCargadas) {
                alert('Primero debes cargar las bibliotecas');
                return;
            }
            
            // Obtener el ticker actual
            const ticker = document.getElementById('input-ticker').value.toUpperCase() || 'AAPL';
            
            if (!datosDemostracion[ticker]) {
                alert(`No hay datos para ${ticker}. Primero obtén los datos.`);
                return;
            }
            
            try {
                // Leer valores de los selects
                const metodo = document.getElementById('select-metodo-ic').value;
                const nivelConfianza = parseFloat(document.getElementById('select-nivel-confianza').value);
                
                // Crear el gráfico de velas
                const visualizador = new VisualizadorFinanciero('grafico-intervalos');
                visualizador.crearGraficoVelas(datosDemostracion[ticker], `${ticker} - Predicción con Intervalos de Confianza`);
                
                // Crear modelo y hacer predicción
                const modelador = new ModelosSeriesTemporales(datosDemostracion[ticker]);
                const prediccion = modelador.modeloARIMA(datosDemostracion[ticker], {p: 5, d: 1, q: 1}, 30);
                
                // Agregar predicción con intervalos de confianza
                visualizador.agregarPrediccionConIntervalos(datosDemostracion[ticker], prediccion, {
                    nombre: `Predicción ARIMA (${Math.round(nivelConfianza * 100)}% IC)`,
                    color: '#FF9800',
                    tipoLinea: 'dashdot',
                    grosor: 3,
                    nivelConfianza: nivelConfianza,
                    metodo: metodo,
                    opacidad: 0.25,
                    mostrarLineasLimite: true
                });
                
                statusBibliotecas.innerHTML = `<p>✅ Predicción generada para ${ticker} con intervalo de confianza del ${Math.round(nivelConfianza * 100)}% usando método: ${metodo}</p>`;
                statusBibliotecas.style.color = '#4CAF50';
            } catch (error) {
                alert('Error al realizar predicción con intervalos: ' + error.message);
                console.error(error);
            }
        });
        
        btnICMultiple.addEventListener('click', () => {
            if (!bibliotecasCargadas) {
                alert('Primero debes cargar las bibliotecas');
                return;
            }
            
            // Obtener el ticker actual
            const ticker = document.getElementById('input-ticker').value.toUpperCase() || 'AAPL';
            
            if (!datosDemostracion[ticker]) {
                alert(`No hay datos para ${ticker}. Primero obtén los datos.`);
                return;
            }
            
            try {
                // Crear el gráfico de velas
                const visualizador = new VisualizadorFinanciero('grafico-intervalos');
                visualizador.crearGraficoVelas(datosDemostracion[ticker], `${ticker} - Múltiples Niveles de Confianza`);
                
                // Crear modelo y hacer predicción
                const modelador = new ModelosSeriesTemporales(datosDemostracion[ticker]);
                const prediccion = modelador.modeloARIMA(datosDemostracion[ticker], {p: 5, d: 1, q: 1}, 30);
                
                // Calcular intervalos con diferentes niveles
                const calculador = new IntervalosConfianza(datosDemostracion[ticker], prediccion);
                const intervalos99 = calculador.calcularIntervaloVolatilidad(20, 0.99);
                const intervalos95 = calculador.calcularIntervaloVolatilidad(20, 0.95);
                const intervalos80 = calculador.calcularIntervaloVolatilidad(20, 0.80);
                
                // Agregar intervalos de más amplio a más estrecho (para que se vean bien superpuestos)
                visualizador.agregarIntervalosConfianza(prediccion, intervalos99, 'Predicción', {
                    color: '#FFE082',
                    colorFill: '#FFB74D',
                    opacidad: 0.15,
                    mostrarLineas: false,
                    nivelConfianza: 99
                });
                
                visualizador.agregarIntervalosConfianza(prediccion, intervalos95, 'Predicción', {
                    color: '#FF9800',
                    colorFill: '#FF9800',
                    opacidad: 0.25,
                    mostrarLineas: false,
                    nivelConfianza: 95
                });
                
                visualizador.agregarIntervalosConfianza(prediccion, intervalos80, 'Predicción', {
                    color: '#F57C00',
                    colorFill: '#F57C00',
                    opacidad: 0.35,
                    mostrarLineas: true,
                    nivelConfianza: 80
                });
                
                // Agregar línea de predicción
                visualizador.agregarPrediccion(prediccion, 'Predicción ARIMA', {
                    color: '#E65100',
                    tipoLinea: 'solid',
                    grosor: 3
                });
                
                statusBibliotecas.innerHTML = `<p>✅ Gráfico generado para ${ticker} con múltiples niveles de confianza (80%, 95%, 99%)</p>`;
                statusBibliotecas.style.color = '#4CAF50';
            } catch (error) {
                alert('Error al generar múltiples intervalos: ' + error.message);
                console.error(error);
            }
        });
    </script>
</body>
</html>